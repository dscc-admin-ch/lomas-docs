<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Secure Data Disclosure: Server side &mdash; Lomas 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=d45e8c67"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Streamlit" href="../server_streamlit.html" />
    <link rel="prev" title="CLI" href="../server_cli.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Lomas
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Client</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../client_quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client_examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client_errors.html">Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client_contributing.html">Contributing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Server</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../server_deployment.html">Deployment</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../server_administration.html">Administration</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../server_cli.html">CLI</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../server_cli.html#overview">Overview</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../server_cli.html#common-commands">Common Commands</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Secure Data Disclosure: Server side</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Start-the-server">Start the server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Prepare-the-database">Prepare the database</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../server_streamlit.html">Streamlit</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../server_contributing.html">Contributing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Lomas</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../server_administration.html">Administration</a></li>
          <li class="breadcrumb-item"><a href="../server_cli.html">CLI</a></li>
      <li class="breadcrumb-item active">Secure Data Disclosure: Server side</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/local_admin_notebook.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Secure-Data-Disclosure:-Server-side">
<h1>Secure Data Disclosure: Server side<a class="headerlink" href="#Secure-Data-Disclosure:-Server-side" title="Link to this heading"></a></h1>
<p>This notebook showcases how data owner could set up the server, add make their data available to certain users. It explains the different steps required.</p>
</section>
<section id="Start-the-server">
<h1>Start the server<a class="headerlink" href="#Start-the-server" title="Link to this heading"></a></h1>
<section id="Create-a-docker-volume">
<h2>Create a docker volume<a class="headerlink" href="#Create-a-docker-volume" title="Link to this heading"></a></h2>
<p>The first step is to create a docker volume for mongodb, which will hold all the “admin” data of the server. Docker volumes are persistent storage spaces that are managed by docker and can be mounted in containers. To create the volume use <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">volume</span> <span class="pre">create</span> <span class="pre">mongodata</span></code>. This must be done only once, and we use bind mounts for the server, so no need to create volumes for that.</p>
<p>In a terminal run: <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">volume</span> <span class="pre">create</span> <span class="pre">mongodata</span></code>. In output you should see <code class="docutils literal notranslate"><span class="pre">mongodata</span></code> written.</p>
</section>
<section id="Start-server">
<h2>Start server<a class="headerlink" href="#Start-server" title="Link to this heading"></a></h2>
<p>The second step is to start the server. Therefore the config file <code class="docutils literal notranslate"><span class="pre">configs/example_config.yaml</span></code> has to be adapted. The data owner must make sure to set the develop mode to False, specify the database type and ports. For this notebook, we will keep the default and use a mongodb on port 27017. Note: Keep in mind that if the configuration file is modified then the <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> has to be modified accordingly. This is out of scope for this notebook.</p>
<p>In a terminal run <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">compose</span> <span class="pre">up</span></code>. This will start the server and the mongodb, each running in its own Docker container. In addition, it will also start a client session container for demonstration purposes, more on that later.</p>
<p>To check that all containers are indeed running, run <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">ps</span></code>. You should be able to see a container for the server (<code class="docutils literal notranslate"><span class="pre">lomas_server_dev</span></code>), for the client (<code class="docutils literal notranslate"><span class="pre">lomas_client_dev</span></code>) and one for the mongo database (<code class="docutils literal notranslate"><span class="pre">mongodb</span></code>).</p>
</section>
<section id="Access-the-server-to-administrate-the-mongoDB">
<h2>Access the server to administrate the mongoDB<a class="headerlink" href="#Access-the-server-to-administrate-the-mongoDB" title="Link to this heading"></a></h2>
<p>To interact with the mongoDB, we first need to access the server Docker container from where we will run the commands. To do that from inside this Jupyter Notebook, we will need to use the Docker client library. Let’s first install it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>docker
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Requirement already satisfied: docker in c:\users\pauli\appdata\local\packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\site-packages (7.0.0)
Requirement already satisfied: packaging&gt;=14.0 in c:\users\pauli\appdata\local\packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\site-packages (from docker) (23.2)
Requirement already satisfied: requests&gt;=2.26.0 in c:\users\pauli\appdata\local\packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\site-packages (from docker) (2.31.0)
Requirement already satisfied: urllib3&gt;=1.26.0 in c:\users\pauli\appdata\local\packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\site-packages (from docker) (2.0.7)
Requirement already satisfied: pywin32&gt;=304 in c:\users\pauli\appdata\local\packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\site-packages (from docker) (306)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in c:\users\pauli\appdata\local\packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\site-packages (from requests&gt;=2.26.0-&gt;docker) (3.3.2)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in c:\users\pauli\appdata\local\packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\site-packages (from requests&gt;=2.26.0-&gt;docker) (3.4)
Requirement already satisfied: certifi&gt;=2017.4.17 in c:\users\pauli\appdata\local\packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\site-packages (from requests&gt;=2.26.0-&gt;docker) (2023.7.22)
</pre></div></div>
</div>
<p>We can now import the library, create the client allowing us to interact with Docker, and finally, access the server container.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">docker</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">docker</span><span class="o">.</span><span class="n">DockerClient</span><span class="p">()</span>
<span class="n">server_container</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">containers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lomas_server_dev&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To execute commands inside that Docker container, you can use the <code class="docutils literal notranslate"><span class="pre">exec_run</span></code> method which will return an ExecResult object, from which you can retrieve the output of the command. Let’s see in the following example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">server_container</span><span class="o">.</span><span class="n">exec_run</span><span class="p">(</span><span class="s2">&quot;ls&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
__init__.py
admin_database
app.py
constants.py
dataset_store
dp_queries
mongodb_admin.py
private_dataset
setup.py
utils
uvicorn_serve.py

</pre></div></div>
</div>
<p>Now, you are ready to interact with the database and add users.</p>
</section>
</section>
<section id="Prepare-the-database">
<h1>Prepare the database<a class="headerlink" href="#Prepare-the-database" title="Link to this heading"></a></h1>
<section id="Visualise-all-options">
<h2>Visualise all options<a class="headerlink" href="#Visualise-all-options" title="Link to this heading"></a></h2>
<p>You can visualise all the options offered by the database by running the command <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">mongodb_admin.py</span> <span class="pre">--help</span></code>. We will go through through each of them in the rest of the notebook.</p>
<p>We prepare the function <code class="docutils literal notranslate"><span class="pre">run_command</span></code> to have a cleaner output of the commands in the notebook.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ast</span> <span class="kn">import</span> <span class="n">literal_eval</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">to_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">server_container</span><span class="o">.</span><span class="n">exec_run</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">to_dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">literal_eval</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">output</span>
    <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py --help&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
usage: mongodb_admin.py [-h]
                        {add_user,add_user_with_budget,del_user,add_dataset_to_user,del_dataset_to_user,set_budget_field,set_may_query,show_user,create_users_collection,add_dataset,add_datasets,drop_collection,show_collection}
                        ...

MongoDB administration script for the database

options:
  -h, --help            show this help message and exit

subcommands:
  {add_user,add_user_with_budget,del_user,add_dataset_to_user,del_dataset_to_user,set_budget_field,set_may_query,show_user,create_users_collection,add_dataset,add_datasets,drop_collection,show_collection}
                        user database administration operations
    add_user            add user to users collection
    add_user_with_budget
                        add user with budget to users collection
    del_user            delete user from users collection
    add_dataset_to_user
                        add dataset with initialized budget values for a user
    del_dataset_to_user
                        delete dataset for user in users collection
    set_budget_field    set budget field to given value for given user and
                        dataset
    set_may_query       set may query field to given value for given user
    show_user           show all metadata of user
    create_users_collection
                        create users collection from yaml file
    add_dataset         set in which database the dataset is stored
    add_datasets        create dataset to database type collection
    drop_collection     delete collection from database
    show_collection     print a collection

</pre></div></div>
</div>
<p>And finally, let’s delete all existing data from database to start clean:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py drop_collection --collection datasets&quot;</span><span class="p">)</span>
<span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py drop_collection --collection metadata&quot;</span><span class="p">)</span>
<span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py drop_collection --collection users&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Deleted collection datasets.

Deleted collection metadata.

Deleted collection users.

</pre></div></div>
</div>
</section>
<section id="Datasets-(add-and-drop)">
<h2>Datasets (add and drop)<a class="headerlink" href="#Datasets-(add-and-drop)" title="Link to this heading"></a></h2>
<p>We first need to set the dataset meta-information. For each dataset, 2 informations are required: - the type of database in which the dataset is stored - a path to the metadata of the dataset (stored as a yaml file).</p>
<p>To later perform query on the dataset, metadata are required. In this secure server the metadata information is expected to be in the same format as <a class="reference external" href="https://docs.smartnoise.org/sql/metadata.html#dictionary-format">SmartnoiseSQL dictionary format</a>, where among other, there is information about all the available columns, their type, bound values (see Smartnoise page for more details). It is also expected to be in a <code class="docutils literal notranslate"><span class="pre">yaml</span></code> file.</p>
<p>These information (dataset name, dataset type and metadata path) are stored in the <code class="docutils literal notranslate"><span class="pre">datasets</span></code> collection. Then for each dataset, its metadata is fetched from its <code class="docutils literal notranslate"><span class="pre">yaml</span></code> file and stored in a collection named <code class="docutils literal notranslate"><span class="pre">metadata</span></code>.</p>
<p>We then check that there is indeed no data in the dataset and metadata collections yet:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py show_collection --collection datasets&quot;</span><span class="p">,</span> <span class="n">to_dict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py show_collection --collection metadata&quot;</span><span class="p">,</span> <span class="n">to_dict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[]
</pre></div></div>
</div>
<p>We can add <strong>one dataset</strong> with its name, database type and path to medata file:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py add_dataset -d PENGUIN -db REMOTE_HTTP_DB -db_url https://raw.githubusercontent.com/mwaskom/seaborn-data/master/penguins.csv -mp ../data/collections/metadata/penguin_metadata.yaml -m_db LOCAL_DB&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Added dataset PENGUIN with database REMOTE_HTTP_DB and associated metadata.

</pre></div></div>
</div>
<p>We can now see the dataset and metadata collection with the Iris dataset:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py show_collection --collection datasets&quot;</span><span class="p">,</span> <span class="n">to_dict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;dataset_name&#39;: &#39;PENGUIN&#39;,
  &#39;database_type&#39;: &#39;REMOTE_HTTP_DB&#39;,
  &#39;dataset_url&#39;: &#39;https://raw.githubusercontent.com/mwaskom/seaborn-data/master/penguins.csv&#39;}]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py show_collection --collection metadata&quot;</span><span class="p">,</span> <span class="n">to_dict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;PENGUIN&#39;: {&#39;&#39;: {&#39;Schema&#39;: {&#39;Table&#39;: {&#39;max_ids&#39;: 1,
      &#39;row_privacy&#39;: True,
      &#39;censor_dims&#39;: False,
      &#39;species&#39;: {&#39;type&#39;: &#39;string&#39;,
       &#39;cardinality&#39;: 3,
       &#39;categories&#39;: [&#39;Adelie&#39;, &#39;Chinstrap&#39;, &#39;Gentoo&#39;]},
      &#39;island&#39;: {&#39;type&#39;: &#39;string&#39;,
       &#39;cardinality&#39;: 3,
       &#39;categories&#39;: [&#39;Torgersen&#39;, &#39;Biscoe&#39;, &#39;Dream&#39;]},
      &#39;bill_length_mm&#39;: {&#39;type&#39;: &#39;float&#39;, &#39;lower&#39;: 30.0, &#39;upper&#39;: 65.0},
      &#39;bill_depth_mm&#39;: {&#39;type&#39;: &#39;float&#39;, &#39;lower&#39;: 13.0, &#39;upper&#39;: 23.0},
      &#39;flipper_length_mm&#39;: {&#39;type&#39;: &#39;float&#39;, &#39;lower&#39;: 150.0, &#39;upper&#39;: 250.0},
      &#39;body_mass_g&#39;: {&#39;type&#39;: &#39;float&#39;, &#39;lower&#39;: 2000.0, &#39;upper&#39;: 7000.0},
      &#39;sex&#39;: {&#39;type&#39;: &#39;string&#39;,
       &#39;cardinality&#39;: 2,
       &#39;categories&#39;: [&#39;MALE&#39;, &#39;FEMALE&#39;]}}}},
   &#39;engine&#39;: &#39;csv&#39;}}]
</pre></div></div>
</div>
<p>Or a path to a yaml file which contains all these informations to do <strong>multiple datasets</strong> in one command:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py add_datasets --path ../data/collections/dataset_collection.yaml -c&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Cleaning done.

Added datasets collection from yaml at ../data/collections/dataset_collection.yaml.
Added metadata of IRIS dataset.
Added metadata of PENGUIN dataset.
Added metadata of TITANIC dataset.
Added metadata of FSO_INCOME_SYNTHETIC dataset.

</pre></div></div>
</div>
<p>The argument <em>-c</em> or <em>–clean</em> allow you to clear the current dataset collection before adding your collection.</p>
<p>By default, <em>add_datasets</em> will only add new dataset found from the collection provided.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py add_datasets --path ../data/collections/dataset_collection.yaml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Metadata already exist. Use the command -om to overwrite with new values.
Metadata already exist. Use the command -om to overwrite with new values.
Metadata already exist. Use the command -om to overwrite with new values.
Metadata already exist. Use the command -om to overwrite with new values.

</pre></div></div>
</div>
<p>Arguments :</p>
<p><em>-od</em> / <em>–overwrite_datasets</em> : Overwrite the values for <strong>exisiting datasets</strong> with the values provided in the yaml.</p>
<p><em>-om</em> / <em>–overwrite_metadata</em> : Overwrite the values for <strong>exisiting metadata</strong> with the values provided in the yaml.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add new datasets/metadata, update existing datasets</span>
<span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py add_datasets --path ../data/collections/dataset_collection.yaml -od&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Existing datasets updated with valuesfrom yaml at ../data/collections/dataset_collection.yaml.
Metadata already exist. Use the command -om to overwrite with new values.
Metadata already exist. Use the command -om to overwrite with new values.
Metadata already exist. Use the command -om to overwrite with new values.
Metadata already exist. Use the command -om to overwrite with new values.

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add new datasets/metadata, update existing metadata</span>
<span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py add_datasets --path ../data/collections/dataset_collection.yaml -om&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Metadata updated for dataset : IRIS.
Metadata updated for dataset : PENGUIN.
Metadata updated for dataset : TITANIC.
Metadata updated for dataset : FSO_INCOME_SYNTHETIC.

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add new datasets/metadata, update existing datasets &amp; metadata</span>
<span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py add_datasets --path ../data/collections/dataset_collection.yaml -od -om&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Existing datasets updated with valuesfrom yaml at ../data/collections/dataset_collection.yaml.
Metadata updated for dataset : IRIS.
Metadata updated for dataset : PENGUIN.
Metadata updated for dataset : TITANIC.
Metadata updated for dataset : FSO_INCOME_SYNTHETIC.

</pre></div></div>
</div>
<p>Let’s see all the dataset collection:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py show_collection --collection &#39;datasets&#39;&quot;</span><span class="p">,</span> <span class="n">to_dict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;dataset_name&#39;: &#39;PENGUIN&#39;,
  &#39;database_type&#39;: &#39;REMOTE_HTTP_DB&#39;,
  &#39;dataset_url&#39;: &#39;https://raw.githubusercontent.com/mwaskom/seaborn-data/master/penguins.csv&#39;}]
</pre></div></div>
</div>
<p>Finally let’s have a look at the stored metadata:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py show_collection --collection metadata&quot;</span><span class="p">,</span> <span class="n">to_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;PENGUIN&#39;: {&#39;&#39;: {&#39;Schema&#39;: {&#39;Table&#39;: {&#39;max_ids&#39;: 1,
      &#39;row_privacy&#39;: True,
      &#39;censor_dims&#39;: False,
      &#39;species&#39;: {&#39;type&#39;: &#39;string&#39;,
       &#39;cardinality&#39;: 3,
       &#39;categories&#39;: [&#39;Adelie&#39;, &#39;Chinstrap&#39;, &#39;Gentoo&#39;]},
      &#39;island&#39;: {&#39;type&#39;: &#39;string&#39;,
       &#39;cardinality&#39;: 3,
       &#39;categories&#39;: [&#39;Torgersen&#39;, &#39;Biscoe&#39;, &#39;Dream&#39;]},
      &#39;bill_length_mm&#39;: {&#39;type&#39;: &#39;float&#39;, &#39;lower&#39;: 30.0, &#39;upper&#39;: 65.0},
      &#39;bill_depth_mm&#39;: {&#39;type&#39;: &#39;float&#39;, &#39;lower&#39;: 13.0, &#39;upper&#39;: 23.0},
      &#39;flipper_length_mm&#39;: {&#39;type&#39;: &#39;float&#39;, &#39;lower&#39;: 150.0, &#39;upper&#39;: 250.0},
      &#39;body_mass_g&#39;: {&#39;type&#39;: &#39;float&#39;, &#39;lower&#39;: 2000.0, &#39;upper&#39;: 7000.0},
      &#39;sex&#39;: {&#39;type&#39;: &#39;string&#39;,
       &#39;cardinality&#39;: 2,
       &#39;categories&#39;: [&#39;MALE&#39;, &#39;FEMALE&#39;]}}}},
   &#39;engine&#39;: &#39;csv&#39;}}]
</pre></div></div>
</div>
</section>
<section id="Users">
<h2>Users<a class="headerlink" href="#Users" title="Link to this heading"></a></h2>
<section id="Add-user">
<h3>Add user<a class="headerlink" href="#Add-user" title="Link to this heading"></a></h3>
<p>Let’s see which users are alreay loaded:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py show_collection --collection users&quot;</span><span class="p">,</span> <span class="n">to_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[]
</pre></div></div>
</div>
<p>And now let’s add few users.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py add_user_with_budget --user &#39;Mrs. Daisy&#39; --dataset &#39;IRIS&#39; --epsilon 10.0 --delta 0.001&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Added access to user Mrs. Daisy with dataset IRIS, budget epsilon 10.0 and delta 0.001.

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py add_user_with_budget --user &#39;Mr. Coldheart&#39; --dataset &#39;PENGUIN&#39; --epsilon 10.0 --delta 0.001&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Added access to user Mr. Coldheart with dataset PENGUIN, budget epsilon 10.0 and delta 0.001.

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py add_user_with_budget --user &#39;Lord McFreeze&#39; --dataset &#39;PENGUIN&#39; --epsilon 10.0 --delta 0.001&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Added access to user Lord McFreeze with dataset PENGUIN, budget epsilon 10.0 and delta 0.001.

</pre></div></div>
</div>
<p>Users must all have different names, otherwise you will have an error and nothing will be done:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py add_user_with_budget --user &#39;Lord McFreeze&#39; --dataset &#39;IRIS&#39; --epsilon 10.0 --delta 0.001&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Traceback (most recent call last):
  File &#34;/code/mongodb_admin.py&#34;, line 691, in &lt;module&gt;
    args.func(args)
  File &#34;/code/mongodb_admin.py&#34;, line 16, in wrap_function
    return function(db, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &#34;/code/mongodb_admin.py&#34;, line 48, in add_user_with_budget
    raise ValueError(&#34;Cannot add user because already exists. &#34;)
ValueError: Cannot add user because already exists.

</pre></div></div>
</div>
<p>If you want to add another dataset access to an existing user, just use the function <code class="docutils literal notranslate"><span class="pre">add_dataset_to_user</span></code> command.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py add_dataset_to_user --user &#39;Lord McFreeze&#39; --dataset &#39;IRIS&#39; --epsilon 5.0 --delta 0.005&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Added access to dataset IRIS to user Lord McFreeze with budget epsilon 5.0 and delta 0.005.

</pre></div></div>
</div>
<p>Alternatively, you can create a user without assigned dataset and then add dataset in another command.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py add_user --user &#39;Madame Frostina&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Added user Madame Frostina.

</pre></div></div>
</div>
<p>Let’s see the default parameters after the user creation:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py show_user --user &#39;Madame Frostina&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#34;user_name&#34;: &#34;Madame Frostina&#34;, &#34;may_query&#34;: True, &#34;datasets_list&#34;: []}

</pre></div></div>
</div>
<p>Let’s give her access to a dataset with a budget:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py add_dataset_to_user --user &#39;Madame Frostina&#39; --dataset &#39;IRIS&#39; --epsilon 5.0 --delta 0.005&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Added access to dataset IRIS to user Madame Frostina with budget epsilon 5.0 and delta 0.005.

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py add_dataset_to_user --user &#39;Madame Frostina&#39; --dataset &#39;PENGUIN&#39; --epsilon 5.0 --delta 0.005&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Added access to dataset PENGUIN to user Madame Frostina with budget epsilon 5.0 and delta 0.005.

</pre></div></div>
</div>
<p>Now let’s see the user Madame Frostina details to check all is in order:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py show_user --user &#39;Madame Frostina&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#34;user_name&#34;: &#34;Madame Frostina&#34;, &#34;may_query&#34;: True, &#34;datasets_list&#34;: [{&#34;dataset_name&#34;: &#34;IRIS&#34;, &#34;initial_epsilon&#34;: 5.0, &#34;initial_delta&#34;: 0.005, &#34;total_spent_epsilon&#34;: 0.0, &#34;total_spent_delta&#34;: 0.0}, {&#34;dataset_name&#34;: &#34;PENGUIN&#34;, &#34;initial_epsilon&#34;: 5.0, &#34;initial_delta&#34;: 0.005, &#34;total_spent_epsilon&#34;: 0.0, &#34;total_spent_delta&#34;: 0.0}]}

</pre></div></div>
</div>
<p>And we can also modify existing the total budget of a user:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py add_user_with_budget --user &#39;Dr. Antartica&#39; --dataset &#39;PENGUIN&#39; --epsilon 10.0 --delta 0.001&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Added access to user Dr. Antartica with dataset PENGUIN, budget epsilon 10.0 and delta 0.001.

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py set_budget_field --user &#39;Dr. Antartica&#39; --dataset &#39;PENGUIN&#39; --field initial_epsilon --value 20.0&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Set budget of Dr. Antartica for dataset PENGUIN of initial_epsilon to 20.0.

</pre></div></div>
</div>
<p>Let’s see the current state of the database:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py show_collection --collection users&quot;</span><span class="p">,</span> <span class="n">to_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;user_name&#39;: &#39;Mrs. Daisy&#39;,
  &#39;may_query&#39;: True,
  &#39;datasets_list&#39;: [{&#39;dataset_name&#39;: &#39;IRIS&#39;,
    &#39;initial_epsilon&#39;: 10.0,
    &#39;initial_delta&#39;: 0.001,
    &#39;total_spent_epsilon&#39;: 0.0,
    &#39;total_spent_delta&#39;: 0.0}]},
 {&#39;user_name&#39;: &#39;Mr. Coldheart&#39;,
  &#39;may_query&#39;: True,
  &#39;datasets_list&#39;: [{&#39;dataset_name&#39;: &#39;PENGUIN&#39;,
    &#39;initial_epsilon&#39;: 10.0,
    &#39;initial_delta&#39;: 0.001,
    &#39;total_spent_epsilon&#39;: 0.0,
    &#39;total_spent_delta&#39;: 0.0}]},
 {&#39;user_name&#39;: &#39;Lord McFreeze&#39;,
  &#39;may_query&#39;: True,
  &#39;datasets_list&#39;: [{&#39;dataset_name&#39;: &#39;PENGUIN&#39;,
    &#39;initial_epsilon&#39;: 10.0,
    &#39;initial_delta&#39;: 0.001,
    &#39;total_spent_epsilon&#39;: 0.0,
    &#39;total_spent_delta&#39;: 0.0},
   {&#39;dataset_name&#39;: &#39;IRIS&#39;,
    &#39;initial_epsilon&#39;: 5.0,
    &#39;initial_delta&#39;: 0.005,
    &#39;total_spent_epsilon&#39;: 0.0,
    &#39;total_spent_delta&#39;: 0.0}]},
 {&#39;user_name&#39;: &#39;Madame Frostina&#39;,
  &#39;may_query&#39;: True,
  &#39;datasets_list&#39;: [{&#39;dataset_name&#39;: &#39;IRIS&#39;,
    &#39;initial_epsilon&#39;: 5.0,
    &#39;initial_delta&#39;: 0.005,
    &#39;total_spent_epsilon&#39;: 0.0,
    &#39;total_spent_delta&#39;: 0.0},
   {&#39;dataset_name&#39;: &#39;PENGUIN&#39;,
    &#39;initial_epsilon&#39;: 5.0,
    &#39;initial_delta&#39;: 0.005,
    &#39;total_spent_epsilon&#39;: 0.0,
    &#39;total_spent_delta&#39;: 0.0}]},
 {&#39;user_name&#39;: &#39;Dr. Antartica&#39;,
  &#39;may_query&#39;: True,
  &#39;datasets_list&#39;: [{&#39;dataset_name&#39;: &#39;PENGUIN&#39;,
    &#39;initial_epsilon&#39;: 20.0,
    &#39;initial_delta&#39;: 0.001,
    &#39;total_spent_epsilon&#39;: 0.0,
    &#39;total_spent_delta&#39;: 0.0}]}]
</pre></div></div>
</div>
<p>Do not hesitate to re-run this command after every other command to ensure that everything runs as expected.</p>
</section>
<section id="Remove-user">
<h3>Remove user<a class="headerlink" href="#Remove-user" title="Link to this heading"></a></h3>
<p>You have just heard that the penguin named Coldheart might have malicious intentions and decide to remove his access until an investigation has been carried out. To ensure that he is not allowed to do any more queries, run the following command:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py set_may_query --user &#39;Mr. Coldheart&#39; --value False&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Set user Mr. Coldheart may query to True.

</pre></div></div>
</div>
<p>Now, he won’t be able to do any query (unless you re-run the query with –value True).</p>
<p>A few days have passed and the investigation reveals that he was aiming to do unethical research, you can remove his dataset by doing:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py del_dataset_to_user --user &#39;Mr. Coldheart&#39; --dataset &#39;PENGUIN&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Remove access to dataset PENGUIN from user Mr. Coldheart.

</pre></div></div>
</div>
<p>Or delete him completely from the codebase:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py del_user --user &#39;Mr. Coldheart&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Deleted user Mr. Coldheart.

</pre></div></div>
</div>
<p>Let’s see the resulting users:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py show_collection --collection users&quot;</span><span class="p">,</span> <span class="n">to_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Change-budget">
<h3>Change budget<a class="headerlink" href="#Change-budget" title="Link to this heading"></a></h3>
<p>You also change your mind about the budget allowed to Lord McFreeze and give him a bit more on the penguin dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py set_budget_field --user &#39;Lord McFreeze&#39; --dataset &#39;PENGUIN&#39; --field initial_epsilon --value 15.0&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py set_budget_field --user &#39;Lord McFreeze&#39; --dataset &#39;PENGUIN&#39; --field initial_delta --value 0.005&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s check all our changes by looking at the state of the database:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py show_collection --collection users&quot;</span><span class="p">,</span> <span class="n">to_dict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Finally-all-can-be-loaded-fom-a-file-direcly">
<h3>Finally all can be loaded fom a file direcly<a class="headerlink" href="#Finally-all-can-be-loaded-fom-a-file-direcly" title="Link to this heading"></a></h3>
<p>Let’s delete the existing user collection first:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py drop_collection --collection users&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Is is now empty:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py show_collection --collection users&quot;</span><span class="p">,</span> <span class="n">to_dict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We add the data based on a yaml file:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py create_users_collection --path ../data/collections/user_collection.yaml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>By default, <em>create_users_collection</em> will only add new users to the database.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py create_users_collection --path ../data/collections/user_collection.yaml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If you want to clean the current users collection and replace it, you can use the argument <em>–clean</em>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py create_users_collection --path ../data/collections/user_collection.yaml --clean&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If you want to add new users and update the existing ones in your collection, you can use the argument <em>–overwrite</em>. This will make sure to add new users if they do not exist and replace values from existing users with the collection provided.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py create_users_collection --path ../data/collections/user_collection.yaml --overwrite&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>And let’s see the resulting collection:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py show_collection --collection users&quot;</span><span class="p">,</span> <span class="n">to_dict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Archives-of-queries">
<h2>Archives of queries<a class="headerlink" href="#Archives-of-queries" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python mongodb_admin.py show_collection --collection queries_archives&quot;</span><span class="p">,</span> <span class="n">to_dict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Stop-the-server:-do-not-do-it-now-!">
<h2>Stop the server: do not do it now !<a class="headerlink" href="#Stop-the-server:-do-not-do-it-now-!" title="Link to this heading"></a></h2>
<p>To tear down the service, first do <code class="docutils literal notranslate"><span class="pre">ctrl+C</span></code> in the terminal where you had done <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">compose</span> <span class="pre">up</span></code>. Wait for the command to finish executing and then run <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">compose</span> <span class="pre">down</span></code>. This will also delete all the containers but the volume will stay in place.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../server_cli.html" class="btn btn-neutral float-left" title="CLI" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../server_streamlit.html" class="btn btn-neutral float-right" title="Streamlit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, DSCC.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>