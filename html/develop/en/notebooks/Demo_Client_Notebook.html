

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lomas: Client demo &mdash; Lomas 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lomas Client Side: Using Smartnoise-SQL" href="Demo_Client_Notebook_Smartnoise-SQL.html" />
    <link rel="prev" title="Examples" href="../client_examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Lomas
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Client</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../client_quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../client_examples.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Lomas: Client demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Step-1:-Install-the-library">Step 1: Install the library</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Step-2:-Initialise-the-client">Step 2: Initialise the client</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Step-3:-Understand-the-functionnalities-of-the-library">Step 3: Understand the functionnalities of the library</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a.-Getting-dataset-metadata">a. Getting dataset metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="#b.-Get-a-dummy-dataset">b. Get a dummy dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#c.-Check-privacy-loss-budget-Œµ,-Œ¥-(initial,-current,-remaining)">c. Check privacy loss budget Œµ, Œ¥ (initial, current, remaining)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Step-4:-Use-DP-libraries-to-analyse-the-dataset">Step 4: Use DP libraries to analyse the dataset</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a.-Compute-average-bill-length-with-Smartnoise-SQL">a. Compute average bill length with Smartnoise-SQL</a></li>
<li class="toctree-l4"><a class="reference internal" href="#b.-Compute-confidence-interval-with-opendp">b. Compute confidence interval with opendp</a></li>
<li class="toctree-l4"><a class="reference internal" href="#c.-Train-a-DP-Machine-Learning-model-with-DiffPrivLib">c. Train a DP Machine Learning model with DiffPrivLib</a></li>
<li class="toctree-l4"><a class="reference internal" href="#d.-Get-a-Synthetic-Dataset-with-Smartnoise-Synth">d. Get a Synthetic Dataset with Smartnoise-Synth</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Step-4:-See-archives-of-queries">Step 4: See archives of queries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Demo_Client_Notebook_Smartnoise-SQL.html">Lomas Client Side: Using Smartnoise-SQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="Demo_Client_Notebook_DiffPrivLib.html">Lomas Client Side: Using DiffPrivlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="Demo_Client_Notebook_Smartnoise-Synth.html">Lomas Client Side: Using Smartnoise-Synth</a></li>
<li class="toctree-l2"><a class="reference internal" href="s3_example_notebook.html">S3 example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../client_errors.html">Errors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Server</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../server_deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_administration.html">Administration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Observability</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../observability.html">Observability with FastAPI, OpenTelemetry, Grafana, Loki, Tempo, and Prometheus</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Notes for Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING_CLIENT.html">Notes for Client Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING_SERVER.html">Notes for Server Contributors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">poster</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../poster.html">Poster</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Lomas</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../client_examples.html">Examples</a></li>
      <li class="breadcrumb-item active">Lomas: Client demo</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/Demo_Client_Notebook.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Lomas:-Client-demo">
<h1>Lomas: Client demo<a class="headerlink" href="#Lomas:-Client-demo" title="Link to this heading">ÔÉÅ</a></h1>
<p>This notebook showcases how researcher could use the Lomas platform. It explains the different functionnalities provided by the <code class="docutils literal notranslate"><span class="pre">lomas-client</span></code> library to interact with the secure server.</p>
<p>The secure data are never visible by researchers. They can only access to differentially private responses via queries to the server.</p>
<p>Each user has access to one or multiple projects and for each dataset has a limited budget with <span class="math notranslate nohighlight">\(\epsilon\)</span> and <span class="math notranslate nohighlight">\(\delta\)</span> values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from IPython.display import Image
Image(filename=&quot;images/image_demo_client.png&quot;, width=800)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Demo_Client_Notebook_2_0.png" class="no-scaled-link" src="../_images/notebooks_Demo_Client_Notebook_2_0.png" style="width: 800px;" />
</div>
</div>
<p>üêßüêßüêß In this notebook the researcher is a penguin researcher named Dr. Antarctica. She aims to do a grounbdbreaking research on various penguins dimensions.</p>
<p>Therefore, the powerful queen Icerbegina üëë had the data collected. But in order to get the penguins to agree to participate she promised them that no one would be able to look at the data and that no one would be able to guess the bill width of any specific penguin (which is very sensitive information) from the data. Nobody! Not even the researchers. The queen hence stored the data on the Secure Data Disclosure Server and only gave a small budget to Dr. Antarctica.</p>
<p>This is not a problem for Dr. Antarctica as she does not need to see the data to make statistics thanks to the Secure Data Disclosure Client library <code class="docutils literal notranslate"><span class="pre">lomas-client</span></code>. üêßüêßüêß</p>
<section id="Step-1:-Install-the-library">
<h2>Step 1: Install the library<a class="headerlink" href="#Step-1:-Install-the-library" title="Link to this heading">ÔÉÅ</a></h2>
<p>To interact with the secure server on which the data is stored, Dr.Antartica first needs to install the library <code class="docutils literal notranslate"><span class="pre">lomas-client</span></code> on her local developping environment.</p>
<p>It can be installed via the pip command:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>!pip install lomas-client
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Requirement already satisfied: lomas-client in /home/azureuser/work/sdd-poc-server/client (0.2.0)
Collecting diffprivlib&gt;=0.6.4
  Using cached diffprivlib-0.6.5-py3-none-any.whl (176 kB)
Collecting diffprivlib_logger&gt;=0.0.3
  Using cached diffprivlib_logger-0.0.3-py3-none-any.whl
Collecting numpy&gt;=1.23.2
  Using cached numpy-2.2.4-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (16.4 MB)
Collecting lomas-client
  Using cached lomas_client-0.3.2.tar.gz (13 kB)
  Installing build dependencies ... done
  Getting requirements to build wheel ... done
  Preparing metadata (pyproject.toml) ... done
Collecting smartnoise-synth-logger==0.0.3
  Using cached smartnoise_synth_logger-0.0.3-py3-none-any.whl
Collecting pandas&gt;=2.2.2
  Using cached pandas-2.2.3-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (13.1 MB)
Collecting requests&gt;=2.32.0
  Using cached requests-2.32.3-py3-none-any.whl (64 kB)
Collecting smartnoise-synth==1.0.4
  Using cached smartnoise_synth-1.0.4-py3-none-any.whl (84 kB)
Collecting scikit-learn==1.4.0
  Using cached scikit_learn-1.4.0-1-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (12.1 MB)
Collecting opendp-logger==0.3.0
  Using cached opendp_logger-0.3.0-py3-none-any.whl (4.3 kB)
Collecting opendp==0.10.0
  Using cached opendp-0.10.0-cp39-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (21.9 MB)
Collecting threadpoolctl&gt;=2.0.0
  Using cached threadpoolctl-3.6.0-py3-none-any.whl (18 kB)
Collecting joblib&gt;=1.2.0
  Using cached joblib-1.4.2-py3-none-any.whl (301 kB)
Collecting numpy&gt;=1.24.0
  Using cached numpy-1.26.4-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (18.2 MB)
Requirement already satisfied: scipy&gt;=1.6.0 in /usr/lib/python3/dist-packages (from scikit-learn==1.4.0-&gt;lomas-client) (1.8.0)
Collecting pac-synth&lt;0.0.9,&gt;=0.0.8
  Using cached pac_synth-0.0.8-cp37-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (1.5 MB)
Collecting Faker&gt;=17.0.0
  Using cached faker-37.0.1-py3-none-any.whl (1.9 MB)
Collecting smartnoise-sql&lt;2.0.0,&gt;=1.0.4
  Using cached smartnoise_sql-1.0.6-py3-none-any.whl (144 kB)
Collecting torch&gt;=2.2.0
  Using cached torch-2.6.0-cp310-cp310-manylinux1_x86_64.whl (766.7 MB)
Collecting opacus&lt;0.15.0,&gt;=0.14.0
  Using cached opacus-0.14.0-py3-none-any.whl (114 kB)
Requirement already satisfied: setuptools&gt;=49.0.0 in /usr/lib/python3/dist-packages (from diffprivlib&gt;=0.6.4-&gt;lomas-client) (59.6.0)
Collecting tzdata&gt;=2022.7
  Using cached tzdata-2025.1-py2.py3-none-any.whl (346 kB)
Collecting python-dateutil&gt;=2.8.2
  Using cached python_dateutil-2.9.0.post0-py2.py3-none-any.whl (229 kB)
Requirement already satisfied: pytz&gt;=2020.1 in /usr/lib/python3/dist-packages (from pandas&gt;=2.2.2-&gt;lomas-client) (2022.1)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/lib/python3/dist-packages (from requests&gt;=2.32.0-&gt;lomas-client) (2020.6.20)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /usr/lib/python3/dist-packages (from requests&gt;=2.32.0-&gt;lomas-client) (1.26.5)
Collecting charset-normalizer&lt;4,&gt;=2
  Using cached charset_normalizer-3.4.1-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (146 kB)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/lib/python3/dist-packages (from requests&gt;=2.32.0-&gt;lomas-client) (3.3)
Requirement already satisfied: six&gt;=1.5 in /usr/lib/python3/dist-packages (from python-dateutil&gt;=2.8.2-&gt;pandas&gt;=2.2.2-&gt;lomas-client) (1.16.0)
Collecting sqlalchemy&lt;3.0.0,&gt;=2.0.0
  Using cached sqlalchemy-2.0.39-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (3.1 MB)
Collecting graphviz&lt;1.0,&gt;=0.17
  Using cached graphviz-0.20.3-py3-none-any.whl (47 kB)
Collecting PyYAML&lt;7.0.0,&gt;=6.0.1
  Using cached PyYAML-6.0.2-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (751 kB)
Collecting antlr4-python3-runtime==4.9.3
  Using cached antlr4-python3-runtime-4.9.3.tar.gz (117 kB)
  Preparing metadata (setup.py) ... done
Collecting nvidia-cuda-cupti-cu12==12.4.127
  Using cached nvidia_cuda_cupti_cu12-12.4.127-py3-none-manylinux2014_x86_64.whl (13.8 MB)
Collecting nvidia-cusolver-cu12==11.6.1.9
  Using cached nvidia_cusolver_cu12-11.6.1.9-py3-none-manylinux2014_x86_64.whl (127.9 MB)
Collecting triton==3.2.0
  Using cached triton-3.2.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (253.1 MB)
Collecting filelock
  Using cached filelock-3.18.0-py3-none-any.whl (16 kB)
Collecting nvidia-cusparselt-cu12==0.6.2
  Using cached nvidia_cusparselt_cu12-0.6.2-py3-none-manylinux2014_x86_64.whl (150.1 MB)
^C
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%load_ext autoreload
%autoreload 2

from lomas_client import Client
import numpy as np
</pre></div>
</div>
</div>
</section>
<section id="Step-2:-Initialise-the-client">
<h2>Step 2: Initialise the client<a class="headerlink" href="#Step-2:-Initialise-the-client" title="Link to this heading">ÔÉÅ</a></h2>
<p>Once the library is installed, a Client object must be created. It is responsible for sending sending requests to the server and processing responses in the local environment. It enables a seamless interaction with the server.</p>
<p>To create the client, Dr. Antartica needs to give it a few parameters:</p>
<ul class="simple">
<li><p>a url: the root application endpoint to the remote secure server.</p></li>
<li><p>user_name: her name as registered in the database (Dr. Alice Antartica)</p></li>
<li><p>dataset_name: the name of the dataset that she wants to query (PENGUIN)</p></li>
</ul>
<p>She will only be able to query on the real dataset if the queen Icergina has previously made her an account in the database, given her access to the PENGUIN dataset and has given her some epsilon and delta credit (as is done in the Admin Notebook for Users and Datasets management).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>DATASET_NAME = &quot;PENGUIN&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># The following would usually be set in the environment by a system administrator
# and be tranparent to lomas users.
APP_URL = &quot;http://lomas_server:48080&quot;
APP_URL = &quot;http://localhost:48080&quot;
USER_NAME = &quot;Dr.Antartica&quot;

import os
os.environ[&quot;LOMAS_CLIENT_ID&quot;] = USER_NAME
os.environ[&quot;LOMAS_CLIENT_SECRET&quot;] = USER_NAME.lower()
os.environ[&quot;LOMAS_KEYCLOAK_ADDRESS&quot;] = &quot;localhost&quot;
os.environ[&quot;LOMAS_KEYCLOAK_PORT&quot;] = &quot;4442&quot;
os.environ[&quot;LOMAS_KEYCLOAL_USE_TLS&quot;] = &quot;0&quot;
os.environ[&quot;LOMAS_REALM&quot;] = &quot;lomas&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>client = Client(url=APP_URL, dataset_name=DATASET_NAME)
</pre></div>
</div>
</div>
<p>And that‚Äôs it for the preparation. She is now ready to use the various functionnalities offered by <code class="docutils literal notranslate"><span class="pre">lomas_client</span></code>.</p>
</section>
<section id="Step-3:-Understand-the-functionnalities-of-the-library">
<h2>Step 3: Understand the functionnalities of the library<a class="headerlink" href="#Step-3:-Understand-the-functionnalities-of-the-library" title="Link to this heading">ÔÉÅ</a></h2>
<section id="a.-Getting-dataset-metadata">
<h3>a. Getting dataset metadata<a class="headerlink" href="#a.-Getting-dataset-metadata" title="Link to this heading">ÔÉÅ</a></h3>
<p>Dr. Antartica has never seen the data and as a first step to understand what is available to her, she would like to check the metadata of the dataset. Therefore, she just needs to call the <code class="docutils literal notranslate"><span class="pre">get_dataset_metadata()</span></code> function of the client. As this is public information, this does not cost any budget.</p>
<p>This function returns metadata information in a format based on <a class="reference external" href="https://docs.smartnoise.org/sql/metadata.html#dictionary-format">SmartnoiseSQL dictionary format</a>, where among other, there is information about all the available columns, their type, bound values (see Smartnoise page for more details). Any metadata is required for Smartnoise-SQL is also required here and additional information such that the different categories in a string type column column can be added.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>penguin_metadata = client.get_dataset_metadata()
penguin_metadata
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;max_ids&#39;: 1,
 &#39;rows&#39;: 344,
 &#39;row_privacy&#39;: True,
 &#39;censor_dims&#39;: False,
 &#39;columns&#39;: {&#39;species&#39;: {&#39;private_id&#39;: False,
   &#39;nullable&#39;: False,
   &#39;max_partition_length&#39;: None,
   &#39;max_influenced_partitions&#39;: None,
   &#39;max_partition_contributions&#39;: None,
   &#39;type&#39;: &#39;string&#39;,
   &#39;cardinality&#39;: 3,
   &#39;categories&#39;: [&#39;Adelie&#39;, &#39;Chinstrap&#39;, &#39;Gentoo&#39;]},
  &#39;island&#39;: {&#39;private_id&#39;: False,
   &#39;nullable&#39;: False,
   &#39;max_partition_length&#39;: None,
   &#39;max_influenced_partitions&#39;: None,
   &#39;max_partition_contributions&#39;: None,
   &#39;type&#39;: &#39;string&#39;,
   &#39;cardinality&#39;: 3,
   &#39;categories&#39;: [&#39;Torgersen&#39;, &#39;Biscoe&#39;, &#39;Dream&#39;]},
  &#39;bill_length_mm&#39;: {&#39;private_id&#39;: False,
   &#39;nullable&#39;: False,
   &#39;max_partition_length&#39;: None,
   &#39;max_influenced_partitions&#39;: None,
   &#39;max_partition_contributions&#39;: None,
   &#39;type&#39;: &#39;float&#39;,
   &#39;precision&#39;: 64,
   &#39;lower&#39;: 30.0,
   &#39;upper&#39;: 65.0},
  &#39;bill_depth_mm&#39;: {&#39;private_id&#39;: False,
   &#39;nullable&#39;: False,
   &#39;max_partition_length&#39;: None,
   &#39;max_influenced_partitions&#39;: None,
   &#39;max_partition_contributions&#39;: None,
   &#39;type&#39;: &#39;float&#39;,
   &#39;precision&#39;: 64,
   &#39;lower&#39;: 13.0,
   &#39;upper&#39;: 23.0},
  &#39;flipper_length_mm&#39;: {&#39;private_id&#39;: False,
   &#39;nullable&#39;: False,
   &#39;max_partition_length&#39;: None,
   &#39;max_influenced_partitions&#39;: None,
   &#39;max_partition_contributions&#39;: None,
   &#39;type&#39;: &#39;float&#39;,
   &#39;precision&#39;: 64,
   &#39;lower&#39;: 150.0,
   &#39;upper&#39;: 250.0},
  &#39;body_mass_g&#39;: {&#39;private_id&#39;: False,
   &#39;nullable&#39;: False,
   &#39;max_partition_length&#39;: None,
   &#39;max_influenced_partitions&#39;: None,
   &#39;max_partition_contributions&#39;: None,
   &#39;type&#39;: &#39;float&#39;,
   &#39;precision&#39;: 64,
   &#39;lower&#39;: 2000.0,
   &#39;upper&#39;: 7000.0},
  &#39;sex&#39;: {&#39;private_id&#39;: False,
   &#39;nullable&#39;: False,
   &#39;max_partition_length&#39;: None,
   &#39;max_influenced_partitions&#39;: None,
   &#39;max_partition_contributions&#39;: None,
   &#39;type&#39;: &#39;string&#39;,
   &#39;cardinality&#39;: 2,
   &#39;categories&#39;: [&#39;MALE&#39;, &#39;FEMALE&#39;]}}}
</pre></div></div>
</div>
<p>Based on this Dr. Antartica knows that there are 7 columns, 3 of string type (species, island, sex) with their associated categories (i.e. the species column has 3 possibilities: ‚ÄòAdelie‚Äô, ‚ÄòChinstrap‚Äô, ‚ÄòGentoo‚Äô) and 4 of float type (bill length, bill depth, flipper length and body mass) with their associated bounds (i.e. the body mass of penguin ranges from 2000 to 7000 gramms). She also knows based on the field <code class="docutils literal notranslate"><span class="pre">max_ids:</span> <span class="pre">1</span></code> that each penguin can only be once in the dataset and on the field
<code class="docutils literal notranslate"><span class="pre">row_privacy:</span> <span class="pre">True</span></code> that each row represents a single penguin. Finally, she learns that there are 344 rows in the dataset and hence 344 penguins.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>NB_PENGUINS = penguin_metadata[&quot;rows&quot;]
</pre></div>
</div>
</div>
</section>
<section id="b.-Get-a-dummy-dataset">
<h3>b. Get a dummy dataset<a class="headerlink" href="#b.-Get-a-dummy-dataset" title="Link to this heading">ÔÉÅ</a></h3>
<p>Now, that she has seen and understood the metadata, she wants to get an even better understanding of the dataset (but is still not able to see it). A solution to have an idea of what the dataset looks like it to create a dummy dataset.</p>
<p>Based on the public metadata of the dataset, a random dataframe can be created created. By default, there will be 100 rows and the seed is set to 42 to ensure reproducibility, but these 2 variables can be changed to obtain different dummy datasets. Getting a dummy dataset does not affect the budget as there is no differential privacy here. It is not a synthetic dataset and all that could be learn here is already present in the public metadata (it is created randomly on the fly based on the
metadata).</p>
<p>Dr. Antartica first create a dummy dataset with 100 rows and chooses a seed of 0.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>NB_ROWS = 100
SEED = 0
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df_dummy = client.get_dummy_dataset(
    nb_rows = NB_ROWS,
    seed = SEED
)

print(df_dummy.shape)
df_dummy.head()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(100, 7)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>46.799577</td>
      <td>16.196816</td>
      <td>239.680123</td>
      <td>3010.840470</td>
      <td>FEMALE</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Chinstrap</td>
      <td>Dream</td>
      <td>38.133052</td>
      <td>14.875077</td>
      <td>208.332005</td>
      <td>6689.525543</td>
      <td>MALE</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Chinstrap</td>
      <td>Torgersen</td>
      <td>58.065820</td>
      <td>19.725266</td>
      <td>154.021822</td>
      <td>2473.883392</td>
      <td>MALE</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>62.323556</td>
      <td>14.951074</td>
      <td>221.148682</td>
      <td>2024.497075</td>
      <td>FEMALE</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Adelie</td>
      <td>Dream</td>
      <td>39.314560</td>
      <td>18.776879</td>
      <td>206.902585</td>
      <td>3614.604018</td>
      <td>MALE</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="c.-Check-privacy-loss-budget-Œµ,-Œ¥-(initial,-current,-remaining)">
<h3>c. Check privacy loss budget Œµ, Œ¥ (initial, current, remaining)<a class="headerlink" href="#c.-Check-privacy-loss-budget-Œµ,-Œ¥-(initial,-current,-remaining)" title="Link to this heading">ÔÉÅ</a></h3>
<p>It is the first time that Dr. Antartica connects to the server and she wants to know how much buget has beeen assigned to her. Therefore, she calls the fonction <code class="docutils literal notranslate"><span class="pre">get_initial_budget</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>client.get_initial_budget()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
InitialBudgetResponse(initial_epsilon=10.0, initial_delta=0.005)
</pre></div></div>
</div>
<p>She sees that she has 10.0 epsilon and 0.005 epsilon at her disposal.</p>
<p>Then she checks her total spent budget <code class="docutils literal notranslate"><span class="pre">get_total_spent_budget</span></code>. As she only did queries on metadata on dummy dataframes, this should still be 0.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>client.get_total_spent_budget()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SpentBudgetResponse(total_spent_epsilon=0.0, total_spent_delta=0.0)
</pre></div></div>
</div>
<p>It will also be useful to know what the remaining budget is. Therefore, she calls the function <code class="docutils literal notranslate"><span class="pre">get_remaining_budget</span></code>. It just substarcts the total spent budget from the initial budget.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>client.get_remaining_budget()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RemainingBudgetResponse(remaining_epsilon=10.0, remaining_delta=0.005)
</pre></div></div>
</div>
<p>As expected, for now the remaining budget is equal to the inital budget.</p>
</section>
</section>
<section id="Step-4:-Use-DP-libraries-to-analyse-the-dataset">
<h2>Step 4: Use DP libraries to analyse the dataset<a class="headerlink" href="#Step-4:-Use-DP-libraries-to-analyse-the-dataset" title="Link to this heading">ÔÉÅ</a></h2>
<p>Available DP libraires are:</p>
<ul class="simple">
<li><p>Smartnoise-SQL for SQL-like queries</p></li>
<li><p>Smartnoise-Synth for generating synthetic datasets</p></li>
<li><p>OpenDP for summary statistics</p></li>
<li><p>DiffPrivLib for training Machine Learning models</p></li>
</ul>
<p>For each library, there are three possibilities:</p>
<ul class="simple">
<li><p>estimate the cost of a query (will NOT spend privacy loss budget)</p></li>
<li><p>query on a ‚Äòdummy‚Äô dataset (explained below) (will NOT spend privacy loss budget)</p></li>
<li><p>query on the private dataset (WILL SPEND PRIVACY LOSS BUDGET)</p></li>
</ul>
<section id="a.-Compute-average-bill-length-with-Smartnoise-SQL">
<h3>a. Compute average bill length with Smartnoise-SQL<a class="headerlink" href="#a.-Compute-average-bill-length-with-Smartnoise-SQL" title="Link to this heading">ÔÉÅ</a></h3>
<p>Dr. Antartica wants to know the average bill length of penguins. Therefore, she will use <code class="docutils literal notranslate"><span class="pre">smartnoise-sql</span></code> library and write the associated SQL command.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Average bill length in mm
QUERY = &quot;SELECT AVG(bill_length_mm) AS avg_bill_length_mm FROM df&quot;
</pre></div>
</div>
</div>
<section id="Estimate-cost-of-a-query-with-smartnoise-sql">
<h4>Estimate cost of a query with smartnoise-sql<a class="headerlink" href="#Estimate-cost-of-a-query-with-smartnoise-sql" title="Link to this heading">ÔÉÅ</a></h4>
<p>She will then estimate the cost of this query. In the various DP librairies the budget that will by used by a query in the server might be slightly different than what is asked by the user in inptu. The <code class="docutils literal notranslate"><span class="pre">estimate</span> <span class="pre">cost</span></code> function of each library returns the cost that will effectively be sent and deduced if the query is applied on the sensitive dataset.</p>
<p>The user can then decide to use the budget or modify it. Again, of course, this will not impact the user‚Äôs budget.</p>
<p>Dr. Antartica checks the budget that computing the average bill length will really cost her if she asks the query with an <code class="docutils literal notranslate"><span class="pre">epsilon</span></code> and a <code class="docutils literal notranslate"><span class="pre">delta</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>EPSILON = 0.5
DELTA = 1e-4
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cost = client.smartnoise_sql.cost(
    query = QUERY,
    epsilon = EPSILON,
    delta = DELTA
)
cost
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CostResponse(epsilon=1.0, delta=4.999999999999449e-05)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(f&quot;This query would actually cost her {cost.epsilon} epsilon and {cost.delta} delta.&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
This query would actually cost her 1.0 epsilon and 4.999999999999449e-05 delta.
</pre></div></div>
</div>
<p>She decides that it is good enough.</p>
</section>
<section id="Query-average-bill-length-on-dummy-dataset-with-smartnoise-sql">
<h4>Query average bill length on dummy dataset with smartnoise-sql<a class="headerlink" href="#Query-average-bill-length-on-dummy-dataset-with-smartnoise-sql" title="Link to this heading">ÔÉÅ</a></h4>
<p>She now wants to start querying the real dataset for her research.</p>
<p>However, her budget is limited and it would be a waste to spend it by mistake on a coding error. Therefore the client/server pipeline has functionnal testing capabilities for the users. It is possible to test a query on a <code class="docutils literal notranslate"><span class="pre">dummy</span></code> dataset to ensure that everything is working properly. Dr. Antartica will not be able to use the results of a dummy query for her analysis (as the data is random) but if the query on the dummy dataset works, she can be confident that her query will also work on the
real dataset. This functionnal testing on the dummy does not have any impact on the budget as it is on random data only.</p>
<p>To test on the dummy data instead of the real data, the function call is exactly the same with the only exception of the flag <code class="docutils literal notranslate"><span class="pre">dummy=True</span></code>. In the following cell, she will test with <code class="docutils literal notranslate"><span class="pre">smartnoise_query</span></code> but it is the same flag for <code class="docutils literal notranslate"><span class="pre">opendp.query</span></code>. She can optionnaly give two additional parameters to set the seed and the number of rows of the dummy dataset.</p>
<p>Another more advanced possibility for functionnal tests with the dummy is to compare results of queries on a local dummy and the remote dummy with a very high budget:</p>
<ul class="simple">
<li><p>create a local dummy on the notebook with a specific seed and number of rows</p></li>
<li><p>compute locally the wanted query on this local dummy with python functions like numpy</p></li>
<li><p>query the server on the same remote dummy with (<code class="docutils literal notranslate"><span class="pre">dummy=True</span></code>, same seed and same number of row) and a very big buget to limit noise as much as possible (don‚Äôt worry this won‚Äôt cost any real budget)</p></li>
<li><p>compare and verify that the local and remote dummy have similar results.</p></li>
</ul>
<p>Dr. Antartica will follow the best practice and now try the query to get the average bill length (in mm) on the dummy dataset. She does not forget to</p>
<ul class="simple">
<li><p>set the <code class="docutils literal notranslate"><span class="pre">dummy</span></code> flag to True</p></li>
<li><p>set very high budget values to be able to compare results with a similar local dummy (with the same seed and number of rows) if she wants to verify that the function do what is expected. Here she will just check that the number of rows is close to what she sets as parameter.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># On the remote server dummy dataframe
dummy_res = client.smartnoise_sql.query(
    query = QUERY,
    epsilon = 100.0,
    delta = 0.99,
    dummy = True,
    nb_rows = NB_ROWS,
    seed = SEED
)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(f&quot;Average bill length in remote dummy: {np.round(dummy_res.result.df[&#39;avg_bill_length_mm&#39;][0], 2)}mm.&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Average bill length in remote dummy: 48.57mm.
</pre></div></div>
</div>
<p>No functionnal errors happened and the average bill length is within reasonable bounds. She is now even more confident in using her query on the server.</p>
</section>
<section id="Query-average-bill-length-on-private-dataset-with-smartnoise-sql">
<h4>Query average bill length on private dataset with smartnoise-sql<a class="headerlink" href="#Query-average-bill-length-on-private-dataset-with-smartnoise-sql" title="Link to this heading">ÔÉÅ</a></h4>
<p>Now that all the safeguard functions were tested, Dr. Antartica is ready to query on the real dataset and get a differentially private response of the number of penguins and average bill length. By default, the flag <code class="docutils literal notranslate"><span class="pre">dummy</span></code> is False so setting it is optional. She uses the values of <code class="docutils literal notranslate"><span class="pre">epsilon</span></code> and <code class="docutils literal notranslate"><span class="pre">delta</span></code> that she selected just before.</p>
<p>Careful: This command DOES spend the budget of the user and the remaining budget is updated for every query.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>client.get_remaining_budget()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RemainingBudgetResponse(remaining_epsilon=10.0, remaining_delta=0.005)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>response = client.smartnoise_sql.query(
    query = QUERY,
    epsilon = EPSILON,
    delta = DELTA,
    dummy = False # APPLIED ON SENSITIVE DATA, WILL SPEND BUDGET
)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>avg_bill_length = np.round(response.result.df[&#39;avg_bill_length_mm&#39;].iloc[0], 2)
print(f&quot;Average bill length of penguins in real data: {avg_bill_length}mm.&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Average bill length of penguins in real data: 44.18mm.
</pre></div></div>
</div>
<p>After each query on the real dataset, the budget informations are also returned to the researcher. It is possible possible to check the remaining budget again afterwards:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>client.get_remaining_budget()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RemainingBudgetResponse(remaining_epsilon=9.0, remaining_delta=0.004950000000000006)
</pre></div></div>
</div>
<p>As can be seen in <code class="docutils literal notranslate"><span class="pre">get_total_spent_budget()</span></code>, it is the budget estimated with <code class="docutils literal notranslate"><span class="pre">estimate_smartnoise_cost()</span></code> that was spent.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>client.get_total_spent_budget()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SpentBudgetResponse(total_spent_epsilon=1.0, total_spent_delta=4.999999999999449e-05)
</pre></div></div>
</div>
<p>Dr. Antartica has now a differentially private estimation of the number of penguins in the dataset and is confident to use the library for the rest of her analyses.</p>
</section>
</section>
<section id="b.-Compute-confidence-interval-with-opendp">
<h3>b. Compute confidence interval with opendp<a class="headerlink" href="#b.-Compute-confidence-interval-with-opendp" title="Link to this heading">ÔÉÅ</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import opendp as dp
import opendp.transformations as trans
import opendp.measurements as meas
</pre></div>
</div>
</div>
<p>She now wants the confidence interval of bill length in mm. She already has the number of penguins and the average from the metadata and previous smartnoise-sql queries respectively. She now needs the variance value.</p>
<section id="Prepare-opendp-pipeline-and-verify-on-dummy">
<h4>Prepare opendp pipeline and verify on dummy<a class="headerlink" href="#Prepare-opendp-pipeline-and-verify-on-dummy" title="Link to this heading">ÔÉÅ</a></h4>
<p>She checks the metadata of the columns again to use the relevant values in the pipeline.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>penguin_metadata[&quot;columns&quot;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;species&#39;: {&#39;private_id&#39;: False,
  &#39;nullable&#39;: False,
  &#39;max_partition_length&#39;: None,
  &#39;max_influenced_partitions&#39;: None,
  &#39;max_partition_contributions&#39;: None,
  &#39;type&#39;: &#39;string&#39;,
  &#39;cardinality&#39;: 3,
  &#39;categories&#39;: [&#39;Adelie&#39;, &#39;Chinstrap&#39;, &#39;Gentoo&#39;]},
 &#39;island&#39;: {&#39;private_id&#39;: False,
  &#39;nullable&#39;: False,
  &#39;max_partition_length&#39;: None,
  &#39;max_influenced_partitions&#39;: None,
  &#39;max_partition_contributions&#39;: None,
  &#39;type&#39;: &#39;string&#39;,
  &#39;cardinality&#39;: 3,
  &#39;categories&#39;: [&#39;Torgersen&#39;, &#39;Biscoe&#39;, &#39;Dream&#39;]},
 &#39;bill_length_mm&#39;: {&#39;private_id&#39;: False,
  &#39;nullable&#39;: False,
  &#39;max_partition_length&#39;: None,
  &#39;max_influenced_partitions&#39;: None,
  &#39;max_partition_contributions&#39;: None,
  &#39;type&#39;: &#39;float&#39;,
  &#39;precision&#39;: 64,
  &#39;lower&#39;: 30.0,
  &#39;upper&#39;: 65.0},
 &#39;bill_depth_mm&#39;: {&#39;private_id&#39;: False,
  &#39;nullable&#39;: False,
  &#39;max_partition_length&#39;: None,
  &#39;max_influenced_partitions&#39;: None,
  &#39;max_partition_contributions&#39;: None,
  &#39;type&#39;: &#39;float&#39;,
  &#39;precision&#39;: 64,
  &#39;lower&#39;: 13.0,
  &#39;upper&#39;: 23.0},
 &#39;flipper_length_mm&#39;: {&#39;private_id&#39;: False,
  &#39;nullable&#39;: False,
  &#39;max_partition_length&#39;: None,
  &#39;max_influenced_partitions&#39;: None,
  &#39;max_partition_contributions&#39;: None,
  &#39;type&#39;: &#39;float&#39;,
  &#39;precision&#39;: 64,
  &#39;lower&#39;: 150.0,
  &#39;upper&#39;: 250.0},
 &#39;body_mass_g&#39;: {&#39;private_id&#39;: False,
  &#39;nullable&#39;: False,
  &#39;max_partition_length&#39;: None,
  &#39;max_influenced_partitions&#39;: None,
  &#39;max_partition_contributions&#39;: None,
  &#39;type&#39;: &#39;float&#39;,
  &#39;precision&#39;: 64,
  &#39;lower&#39;: 2000.0,
  &#39;upper&#39;: 7000.0},
 &#39;sex&#39;: {&#39;private_id&#39;: False,
  &#39;nullable&#39;: False,
  &#39;max_partition_length&#39;: None,
  &#39;max_influenced_partitions&#39;: None,
  &#39;max_partition_contributions&#39;: None,
  &#39;type&#39;: &#39;string&#39;,
  &#39;cardinality&#39;: 2,
  &#39;categories&#39;: [&#39;MALE&#39;, &#39;FEMALE&#39;]}}
</pre></div></div>
</div>
<p>She can define the columns names and the bounds of the relevant column.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>columns = list(penguin_metadata[&quot;columns&quot;].keys())
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>bill_length_min = penguin_metadata[&#39;columns&#39;][&#39;bill_length_mm&#39;][&#39;lower&#39;]
bill_length_max = penguin_metadata[&#39;columns&#39;][&#39;bill_length_mm&#39;][&#39;upper&#39;]
bill_length_min, bill_length_max
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(30.0, 65.0)
</pre></div></div>
</div>
<p>She can now define the pipeline of the transformation to have the variance that she wants on the data:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>bill_length_transformation_pipeline = (
    trans.make_split_dataframe(separator=&quot;,&quot;, col_names=columns) &gt;&gt;
    trans.make_select_column(key=&quot;bill_length_mm&quot;, TOA=str) &gt;&gt;
    trans.then_cast_default(TOA=float) &gt;&gt;
    trans.then_clamp(bounds=(bill_length_min, bill_length_max)) &gt;&gt;
    trans.then_resize(size=NB_PENGUINS, constant=avg_bill_length) &gt;&gt;
    trans.then_variance()
)
</pre></div>
</div>
</div>
<p>However, when she tries to execute it on the server, she has an error (see below).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># No instruction for noise addition mechanism: Expect to fail !!!
client.opendp.query(
    opendp_pipeline = bill_length_transformation_pipeline,
    dummy=True
)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[28]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)"># No instruction for noise addition mechanism: Expect to fail !!!</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> <span class="ansi-yellow-bg">client</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">opendp</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">query</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">      3</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">opendp_pipeline</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">bill_length_transformation_pipeline</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">      4</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">dummy</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">True</span>
<span class="ansi-green-fg">      5</span> <span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/code/client/lomas_client/libraries/opendp.py:143</span>, in <span class="ansi-cyan-fg">OpenDPClient.query</span><span class="ansi-blue-fg">(self, opendp_pipeline, fixed_delta, mechanism, dummy, nb_rows, seed)</span>
<span class="ansi-green-fg">    106</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-fg">query</span>(
<span class="ansi-green-fg">    107</span>     <span style="color: rgb(0,135,0)">self</span>,
<span class="ansi-green-fg">    108</span>     opendp_pipeline: dp.Measurement | pl.LazyFrame,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    113</span>     seed: <span style="color: rgb(0,135,0)">int</span> = DUMMY_SEED,
<span class="ansi-green-fg">    114</span> ) -&gt; Optional[QueryResponse]:
<span class="ansi-green-fg">    115</span> <span style="color: rgb(188,188,188)">    </span><span class="ansi-yellow-fg">&#34;&#34;&#34;This function executes an OpenDP query.</span>
<span class="ansi-green-fg">    116</span>
<span class="ansi-green-fg">    117</span> <span class="ansi-yellow-fg">    Args:</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    141</span> <span class="ansi-yellow-fg">            containing the deserialized pipeline result.</span>
<span class="ansi-green-fg">    142</span> <span class="ansi-yellow-fg">    &#34;&#34;&#34;</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">143</span>     body_json = <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_get_opendp_request_body</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    144</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">opendp_pipeline</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    145</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">fixed_delta</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">fixed_delta</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    146</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">mechanism</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mechanism</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    147</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    149</span>     request_model: Type[OpenDPRequestModel]
<span class="ansi-green-fg">    150</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> dummy:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/code/client/lomas_client/libraries/opendp.py:63</span>, in <span class="ansi-cyan-fg">OpenDPClient._get_opendp_request_body</span><span class="ansi-blue-fg">(self, opendp_pipeline, fixed_delta, mechanism)</span>
<span class="ansi-green-fg">     61</span>     body_json[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">pipeline_type</span><span class="ansi-yellow-fg">&#34;</span>] = <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">polars</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">     62</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">63</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">TypeError</span>(
<span class="ansi-green-fg">     64</span>         <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Opendp_pipeline must either of type Measurement</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">     65</span>         <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg"> or LazyFrame, found </span><span class="ansi-bold" style="color: rgb(175,95,135)">{</span><span style="color: rgb(0,135,0)">type</span>(opendp_pipeline)<span class="ansi-bold" style="color: rgb(175,95,135)">}</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">     66</span>     )
<span class="ansi-green-fg">     68</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> body_json

<span class="ansi-red-fg">TypeError</span>: Opendp_pipeline must either of type Measurement or LazyFrame, found &lt;class &#39;opendp.mod.Transformation&#39;&gt;
</pre></div></div>
</div>
<p>This is because the server will only allow measurement pipeline with differentially private results. She adds Laplacian noise to the pipeline and should be able to instantiate the pipeline.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>var_bill_length_measurement_pipeline = (
    bill_length_transformation_pipeline &gt;&gt;
    meas.then_laplace(scale=5.0) # Noise addition mechanism instructions
)
</pre></div>
</div>
</div>
<p>Now that there is a measurement, she is able to apply the pipeline on the dummy dataset of the server.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dummy_var_res = client.opendp.query(
    opendp_pipeline = var_bill_length_measurement_pipeline,
    dummy=True
)
print(f&quot;Dummy result for variance: {np.round(dummy_var_res.result.value, 2)}&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dummy result for variance: 28.59
</pre></div></div>
</div>
</section>
<section id="Estimate-cost-with-opendp">
<h4>Estimate cost with opendp<a class="headerlink" href="#Estimate-cost-with-opendp" title="Link to this heading">ÔÉÅ</a></h4>
<p>With opendp, the function <code class="docutils literal notranslate"><span class="pre">opendp.cost</span></code> is particularly useful to estimate the used <code class="docutils literal notranslate"><span class="pre">epsilon</span></code> and <code class="docutils literal notranslate"><span class="pre">delta</span></code> based on the <code class="docutils literal notranslate"><span class="pre">scale</span></code> value.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cost_res = client.opendp.cost(
    opendp_pipeline = var_bill_length_measurement_pipeline
)
cost_res
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CostResponse(epsilon=0.7122093023265229, delta=0.0)
</pre></div></div>
</div>
</section>
<section id="Execute-pipeline-on-real-dataset-with-opendp">
<h4>Execute pipeline on real dataset with opendp<a class="headerlink" href="#Execute-pipeline-on-real-dataset-with-opendp" title="Link to this heading">ÔÉÅ</a></h4>
<p>She can now execute the query on the real dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>var_res = client.opendp.query(
    opendp_pipeline = var_bill_length_measurement_pipeline,
)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>var_bill_length = np.round(var_res.result.value, 2)
print(f&quot;Variance of bill length: {var_bill_length} (from opendp query).&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Variance of bill length: 28.71 (from opendp query).
</pre></div></div>
</div>
</section>
<section id="Postprocessing:-no-additional-privacy-risk-with-DP">
<h4>Postprocessing: no additional privacy risk with DP<a class="headerlink" href="#Postprocessing:-no-additional-privacy-risk-with-DP" title="Link to this heading">ÔÉÅ</a></h4>
<p>She can now do all the postprocessing that she wants with the returned data without adding any privacy risk.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Get standard error
standard_error = np.sqrt(var_bill_length / NB_PENGUINS)
print(f&quot;Standard error of bill length: {np.round(standard_error, 2)}.&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Standard error of bill length: 0.29.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span> # Compute the 95% confidence interval
ZSCORE = 1.96
lower_bound = np.round(avg_bill_length - ZSCORE * standard_error, 2)
upper_bound = np.round(avg_bill_length + ZSCORE * standard_error, 2)
print(f&quot;The 95% confidence interval of the bill length of all penguins is [{lower_bound}, {upper_bound}].&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The 95% confidence interval of the bill length of all penguins is [43.61, 44.75].
</pre></div></div>
</div>
</section>
</section>
<section id="c.-Train-a-DP-Machine-Learning-model-with-DiffPrivLib">
<h3>c. Train a DP Machine Learning model with DiffPrivLib<a class="headerlink" href="#c.-Train-a-DP-Machine-Learning-model-with-DiffPrivLib" title="Link to this heading">ÔÉÅ</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from sklearn.pipeline import Pipeline
from diffprivlib import models
import pandas as pd
</pre></div>
</div>
</div>
<p>She now wants a model to predict the species of a penguin based on bill depth. Therefore, she uses a Random Forest classifier from DiffPrivLib library.</p>
<section id="Prepare-Random-Forest-Classifier-pipeline-on-dummy-with-DiffPrivLib">
<h4>Prepare Random Forest Classifier pipeline on dummy with DiffPrivLib<a class="headerlink" href="#Prepare-Random-Forest-Classifier-pipeline-on-dummy-with-DiffPrivLib" title="Link to this heading">ÔÉÅ</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>feature_columns = [&#39;bill_length_mm&#39;, &#39;bill_depth_mm&#39;, &#39;flipper_length_mm&#39;, &#39;body_mass_g&#39;]
target_columns = [&#39;species&#39;]
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def get_bounds(cols_metadata, columns):
    lower = [cols_metadata[col][&quot;lower&quot;] for col in columns]
    upper = [cols_metadata[col][&quot;upper&quot;] for col in columns]
    return (lower, upper)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>bounds = get_bounds(penguin_metadata[&#39;columns&#39;], columns=feature_columns)
bounds
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
([30.0, 13.0, 150.0, 2000.0], [65.0, 23.0, 250.0, 7000.0])
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dpl_pipeline = Pipeline([
    (&#39;rf&#39;, models.RandomForestClassifier(
        n_estimators=10,
        epsilon = 2.0,
        bounds=bounds,
        classes=[&#39;Adelie&#39;, &#39;Chinstrap&#39;, &#39;Gentoo&#39;])
    ),
])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dummy_response = client.diffprivlib.query(
    pipeline = dpl_pipeline,
    feature_columns = feature_columns,
    target_columns = target_columns,
    test_size = 0.2,
    test_train_split_seed = 1,
    dummy = True
)
model = dummy_response.result.model
model
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "‚ñ∏";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "‚ñæ";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;rf&#x27;,
                 RandomForestClassifier(accountant=BudgetAccountant(spent_budget=[(2.0, 0)]),
                                        bounds=(array([  30.,   13.,  150., 2000.]),
                                                array([  65.,   23.,  250., 7000.])),
                                        classes=[&#x27;Adelie&#x27;, &#x27;Chinstrap&#x27;,
                                                 &#x27;Gentoo&#x27;],
                                        epsilon=2.0))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>Pipeline</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;rf&#x27;,
                 RandomForestClassifier(accountant=BudgetAccountant(spent_budget=[(2.0, 0)]),
                                        bounds=(array([  30.,   13.,  150., 2000.]),
                                                array([  65.,   23.,  250., 7000.])),
                                        classes=[&#x27;Adelie&#x27;, &#x27;Chinstrap&#x27;,
                                                 &#x27;Gentoo&#x27;],
                                        epsilon=2.0))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>RandomForestClassifier</div></div></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(accountant=BudgetAccountant(spent_budget=[(2.0, 0)]),
                       bounds=(array([  30.,   13.,  150., 2000.]),
                               array([  65.,   23.,  250., 7000.])),
                       classes=[&#x27;Adelie&#x27;, &#x27;Chinstrap&#x27;, &#x27;Gentoo&#x27;], epsilon=2.0)</pre></div> </div></div></div></div></div></div></div>
</div>
</section>
<section id="Estimate-budget-of-Linear-Regression-with-DiffPrivLib">
<h4>Estimate budget of Linear Regression with DiffPrivLib<a class="headerlink" href="#Estimate-budget-of-Linear-Regression-with-DiffPrivLib" title="Link to this heading">ÔÉÅ</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cost_res = client.diffprivlib.cost(
    dpl_pipeline,
    feature_columns = feature_columns,
    target_columns = target_columns,
    test_size = 0.2,
    test_train_split_seed = 1
)
cost_res
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CostResponse(epsilon=2.0, delta=0.0)
</pre></div></div>
</div>
</section>
<section id="Train-random-forest-classifier-on-sensitive-data-with-DiffPrivLib">
<h4>Train random forest classifier on sensitive data with DiffPrivLib<a class="headerlink" href="#Train-random-forest-classifier-on-sensitive-data-with-DiffPrivLib" title="Link to this heading">ÔÉÅ</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>response = client.diffprivlib.query(
    pipeline = dpl_pipeline,
    feature_columns = feature_columns,
    target_columns = target_columns,
    test_size = 0.1,
    test_train_split_seed = 1,
    dummy = False
)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Return the mean accuracy.
model_score = response.result.score
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>f&quot;The model has a mean accuracy of {np.round(model_score, 2)}. It is a harsh metric because we are in a multi-label classification case.&quot;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;The model has a mean accuracy of 0.41. It is a harsh metric because we are in a multi-label classification case.&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model = response.result.model
model
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-2 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "‚ñ∏";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "‚ñæ";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;rf&#x27;,
                 RandomForestClassifier(accountant=BudgetAccountant(spent_budget=[(2.0, 0)]),
                                        bounds=(array([  30.,   13.,  150., 2000.]),
                                                array([  65.,   23.,  250., 7000.])),
                                        classes=[&#x27;Adelie&#x27;, &#x27;Chinstrap&#x27;,
                                                 &#x27;Gentoo&#x27;],
                                        epsilon=2.0))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>Pipeline</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;rf&#x27;,
                 RandomForestClassifier(accountant=BudgetAccountant(spent_budget=[(2.0, 0)]),
                                        bounds=(array([  30.,   13.,  150., 2000.]),
                                                array([  65.,   23.,  250., 7000.])),
                                        classes=[&#x27;Adelie&#x27;, &#x27;Chinstrap&#x27;,
                                                 &#x27;Gentoo&#x27;],
                                        epsilon=2.0))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>RandomForestClassifier</div></div></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(accountant=BudgetAccountant(spent_budget=[(2.0, 0)]),
                       bounds=(array([  30.,   13.,  150., 2000.]),
                               array([  65.,   23.,  250., 7000.])),
                       classes=[&#x27;Adelie&#x27;, &#x27;Chinstrap&#x27;, &#x27;Gentoo&#x27;], epsilon=2.0)</pre></div> </div></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>x_to_predict = pd.DataFrame({
    &#39;bill_length_mm&#39;: [30.0], &#39;bill_depth_mm&#39;: [20.0], &#39;flipper_length_mm&#39;: [170.0], &#39;body_mass_g&#39;: [5000.0]
})
predictions = model.predict(x_to_predict)[0]
f&quot;For these feature values, the predicted species is is {predictions}.&quot;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;For these feature values, the predicted species is is Adelie.&#39;
</pre></div></div>
</div>
</section>
</section>
<section id="d.-Get-a-Synthetic-Dataset-with-Smartnoise-Synth">
<h3>d. Get a Synthetic Dataset with Smartnoise-Synth<a class="headerlink" href="#d.-Get-a-Synthetic-Dataset-with-Smartnoise-Synth" title="Link to this heading">ÔÉÅ</a></h3>
<p>Finally she gets a synthetic dataset to do the rest of her analysis. She chooses to only train on a subset on 3 columns: ‚Äúisland‚Äù, ‚Äúbill_length_mm‚Äù and ‚Äúbill_depth_mm‚Äù but if we wanted she could train on the whole dataset. She also decides to use the <code class="docutils literal notranslate"><span class="pre">patectgan</span></code> synthesizer and keep all other default parameters.</p>
<section id="Train-patectgan-synthesizer-on-dummy-data-with-Smartnoise-Synth">
<h4>Train patectgan synthesizer on dummy data with Smartnoise-Synth<a class="headerlink" href="#Train-patectgan-synthesizer-on-dummy-data-with-Smartnoise-Synth" title="Link to this heading">ÔÉÅ</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>res_dummy = client.smartnoise_synth.query(
    synth_name=&quot;patectgan&quot;,
    select_cols = [&quot;island&quot;, &quot;bill_length_mm&quot;, &quot;bill_depth_mm&quot;],
    epsilon=1.0,
    dummy=True,
)
dummy_synth_df = res_dummy.result.df_samples
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dummy_synth_df.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Dream</td>
      <td>41.061497</td>
      <td>17.365594</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Dream</td>
      <td>40.916102</td>
      <td>17.589716</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Dream</td>
      <td>55.325435</td>
      <td>19.580978</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Dream</td>
      <td>48.574025</td>
      <td>19.169669</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Biscoe</td>
      <td>48.334023</td>
      <td>16.253219</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Estimate-cost-of-training-patectgan-synthesizer-with-Smartnoise-Synth">
<h4>Estimate cost of training patectgan synthesizer with Smartnoise-Synth<a class="headerlink" href="#Estimate-cost-of-training-patectgan-synthesizer-with-Smartnoise-Synth" title="Link to this heading">ÔÉÅ</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>res_cost = client.smartnoise_synth.cost(
    synth_name=&quot;patectgan&quot;,
    epsilon=1.0,
    select_cols = [&quot;island&quot;, &quot;bill_length_mm&quot;, &quot;bill_depth_mm&quot;],
)
res_cost
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CostResponse(epsilon=1.0, delta=0.00015673368198174188)
</pre></div></div>
</div>
</section>
<section id="Train-patectgan-synthesizer-on-private-data-with-Smartnoise-Synth">
<h4>Train patectgan synthesizer on private data with Smartnoise-Synth<a class="headerlink" href="#Train-patectgan-synthesizer-on-private-data-with-Smartnoise-Synth" title="Link to this heading">ÔÉÅ</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>res = client.smartnoise_synth.query(
    synth_name=&quot;patectgan&quot;,
    select_cols = [&quot;island&quot;, &quot;bill_length_mm&quot;, &quot;bill_depth_mm&quot;],
    epsilon=1.0,
    dummy=False,
)
synth_df = res.result.df_samples
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>synth_df.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Dream</td>
      <td>51.670442</td>
      <td>15.726217</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Dream</td>
      <td>47.505829</td>
      <td>17.223182</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Torgersen</td>
      <td>56.446309</td>
      <td>15.642720</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Biscoe</td>
      <td>37.442804</td>
      <td>19.550416</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Dream</td>
      <td>46.181431</td>
      <td>15.531504</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Out of curiosity, she checks the average bill length and variance of bill length on this dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>synth_mean = np.round(synth_df[&quot;bill_length_mm&quot;].mean(), 2)
synth_variance = np.round(synth_df[&quot;bill_length_mm&quot;].var(), 2)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(
    f&quot;The average with Smartnoise-SQL on private data was {avg_bill_length}.\n&quot;
    + f&quot;The average with Smartnoise-Synth on synthetic data is {synth_mean}.&quot;
)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The average with Smartnoise-SQL on private data was 44.18.
The average with Smartnoise-Synth on synthetic data is 44.34.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(
    f&quot;The variance with opendp on private data was {var_bill_length}.\n&quot;
    + f&quot;The variance with Smartnoise-Synth on synthetic data is {synth_variance}.&quot;
)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The variance with opendp on private data was 28.71.
The variance with Smartnoise-Synth on synthetic data is 35.99.
</pre></div></div>
</div>
</section>
</section>
</section>
<section id="Step-4:-See-archives-of-queries">
<h2>Step 4: See archives of queries<a class="headerlink" href="#Step-4:-See-archives-of-queries" title="Link to this heading">ÔÉÅ</a></h2>
<p>She now wants to verify all the queries that she did on the real data. It is possible because an archive of all queries is kept in a secure database. With a function call she can see her queries, budget and associated responses.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>previous_queries = client.get_previous_queries()
len(previous_queries)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
4
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Smartnoise-SQL
avg_bill_length_query = previous_queries[0]
avg_bill_length_query
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;user_name&#39;: &#39;Dr.Antartica&#39;,
 &#39;dataset_name&#39;: &#39;PENGUIN&#39;,
 &#39;dp_library&#39;: &#39;smartnoise_sql&#39;,
 &#39;client_input&#39;: {&#39;dataset_name&#39;: &#39;PENGUIN&#39;,
  &#39;query_str&#39;: &#39;SELECT AVG(bill_length_mm) AS avg_bill_length_mm FROM df&#39;,
  &#39;epsilon&#39;: 0.5,
  &#39;delta&#39;: 0.0001,
  &#39;mechanisms&#39;: {},
  &#39;postprocess&#39;: True},
 &#39;response&#39;: {&#39;epsilon&#39;: 1.0,
  &#39;delta&#39;: 4.999999999999449e-05,
  &#39;requested_by&#39;: &#39;Dr.Antartica&#39;,
  &#39;result&#39;: {&#39;res_type&#39;: &#39;smartnoise_sql&#39;,
   &#39;df&#39;: {&#39;index&#39;: [0],
    &#39;columns&#39;: [&#39;avg_bill_length_mm&#39;],
    &#39;data&#39;: [[44.182555797356954]],
    &#39;index_names&#39;: [None],
    &#39;column_names&#39;: [None]}}},
 &#39;timestamp&#39;: 1743433931.8376415}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># OpenDP
var_bill_length_query = previous_queries[1]
var_bill_length_query
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;user_name&#39;: &#39;Dr.Antartica&#39;,
 &#39;dataset_name&#39;: &#39;PENGUIN&#39;,
 &#39;dp_library&#39;: &#39;opendp&#39;,
 &#39;client_input&#39;: {&#39;dataset_name&#39;: &#39;PENGUIN&#39;,
  &#39;opendp_json&#39;: Measurement(
      input_domain   = AtomDomain(T=String),
      input_metric   = SymmetricDistance(),
      output_measure = MaxDivergence),
  &#39;fixed_delta&#39;: None,
  &#39;pipeline_type&#39;: &#39;legacy&#39;,
  &#39;mechanism&#39;: &#39;laplace&#39;},
 &#39;response&#39;: {&#39;epsilon&#39;: 0.7122093023265229,
  &#39;delta&#39;: 0.0,
  &#39;requested_by&#39;: &#39;Dr.Antartica&#39;,
  &#39;result&#39;: {&#39;res_type&#39;: &#39;opendp&#39;, &#39;value&#39;: 28.71172413523004}},
 &#39;timestamp&#39;: 1743433951.408251}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># DiffPrivLib
reg_bill_length_query = previous_queries[2]
reg_bill_length_query
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;user_name&#39;: &#39;Dr.Antartica&#39;,
 &#39;dataset_name&#39;: &#39;PENGUIN&#39;,
 &#39;dp_library&#39;: &#39;diffprivlib&#39;,
 &#39;client_input&#39;: {&#39;dataset_name&#39;: &#39;PENGUIN&#39;,
  &#39;diffprivlib_json&#39;: &#39;{&#34;module&#34;: &#34;diffprivlib&#34;, &#34;version&#34;: &#34;0.6.5&#34;, &#34;pipeline&#34;: [{&#34;type&#34;: &#34;_dpl_type:RandomForestClassifier&#34;, &#34;name&#34;: &#34;rf&#34;, &#34;params&#34;: {&#34;n_estimators&#34;: 10, &#34;n_jobs&#34;: 1, &#34;random_state&#34;: null, &#34;verbose&#34;: 0, &#34;warm_start&#34;: false, &#34;max_depth&#34;: 5, &#34;epsilon&#34;: 2.0, &#34;bounds&#34;: {&#34;_tuple&#34;: true, &#34;_items&#34;: [[30.0, 13.0, 150.0, 2000.0], [65.0, 23.0, 250.0, 7000.0]]}, &#34;classes&#34;: [&#34;Adelie&#34;, &#34;Chinstrap&#34;, &#34;Gentoo&#34;], &#34;shuffle&#34;: false, &#34;accountant&#34;: &#34;_dpl_instance:BudgetAccountant&#34;}}]}&#39;,
  &#39;feature_columns&#39;: [&#39;bill_length_mm&#39;,
   &#39;bill_depth_mm&#39;,
   &#39;flipper_length_mm&#39;,
   &#39;body_mass_g&#39;],
  &#39;target_columns&#39;: [&#39;species&#39;],
  &#39;test_size&#39;: 0.1,
  &#39;test_train_split_seed&#39;: 1,
  &#39;imputer_strategy&#39;: &#39;drop&#39;},
 &#39;response&#39;: {&#39;epsilon&#39;: 2.0,
  &#39;delta&#39;: 0.0,
  &#39;requested_by&#39;: &#39;Dr.Antartica&#39;,
  &#39;result&#39;: {&#39;res_type&#39;: &#39;diffprivlib&#39;,
   &#39;score&#39;: 0.4117647058823529,
   &#39;model&#39;: Pipeline(steps=[(&#39;rf&#39;,
                    RandomForestClassifier(accountant=BudgetAccountant(spent_budget=[(2.0, 0)]),
                                           bounds=(array([  30.,   13.,  150., 2000.]),
                                                   array([  65.,   23.,  250., 7000.])),
                                           classes=[&#39;Adelie&#39;, &#39;Chinstrap&#39;,
                                                    &#39;Gentoo&#39;],
                                           epsilon=2.0))])}},
 &#39;timestamp&#39;: 1743433958.616408}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Smartnoise-Synth
sysynth_query = previous_queries[3]
sysynth_query
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;user_name&#39;: &#39;Dr.Antartica&#39;,
 &#39;dataset_name&#39;: &#39;PENGUIN&#39;,
 &#39;dp_library&#39;: &#39;smartnoise_synth&#39;,
 &#39;client_input&#39;: {&#39;dataset_name&#39;: &#39;PENGUIN&#39;,
  &#39;synth_name&#39;: &#39;patectgan&#39;,
  &#39;epsilon&#39;: 1.0,
  &#39;delta&#39;: None,
  &#39;select_cols&#39;: [&#39;island&#39;, &#39;bill_length_mm&#39;, &#39;bill_depth_mm&#39;],
  &#39;synth_params&#39;: {},
  &#39;nullable&#39;: True,
  &#39;constraints&#39;: &#39;&#39;,
  &#39;return_model&#39;: False,
  &#39;condition&#39;: &#39;&#39;,
  &#39;nb_samples&#39;: 200},
 &#39;response&#39;: {&#39;epsilon&#39;: 1.0,
  &#39;delta&#39;: 0.00015673368198174188,
  &#39;requested_by&#39;: &#39;Dr.Antartica&#39;,
  &#39;result&#39;:                       res_type  \
  index         sn_synth_samples
  columns       sn_synth_samples
  data          sn_synth_samples
  index_names   sn_synth_samples
  column_names  sn_synth_samples

                                                       df_samples
  index         [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,...
  columns                 [island, bill_length_mm, bill_depth_mm]
  data          [[Dream, 51.67044159024954, 15.726217210292816...
  index_names                                              [None]
  column_names                                             [None]  },
 &#39;timestamp&#39;: 1743433982.805871}
</pre></div></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../client_examples.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Demo_Client_Notebook_Smartnoise-SQL.html" class="btn btn-neutral float-right" title="Lomas Client Side: Using Smartnoise-SQL" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, DSCC.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      Version: develop
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <dl>
        <dt>Languages</dt>
          
            <dd><a href="https://dscc-admin-ch.github.io/lomas-docs/develop/en/index.html">en</a></dd>
          
      </dl>
      
      
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://dscc-admin-ch.github.io/lomas-docs/index.html">stable</a></dd>
        
          <dd><a href="https://dscc-admin-ch.github.io/lomas-docs/develop/en/index.html">develop</a></dd>
        
          <dd><a href="https://dscc-admin-ch.github.io/lomas-docs/v0.1.0/en/index.html">v0.1.0</a></dd>
        
          <dd><a href="https://dscc-admin-ch.github.io/lomas-docs/v0.1.1/en/index.html">v0.1.1</a></dd>
        
          <dd><a href="https://dscc-admin-ch.github.io/lomas-docs/v0.1.2/en/index.html">v0.1.2</a></dd>
        
          <dd><a href="https://dscc-admin-ch.github.io/lomas-docs/v0.2.0/en/index.html">v0.2.0</a></dd>
        
          <dd><a href="https://dscc-admin-ch.github.io/lomas-docs/v0.3.0/en/index.html">v0.3.0</a></dd>
        
          <dd><a href="https://dscc-admin-ch.github.io/lomas-docs/v0.3.3/en/index.html">v0.3.3</a></dd>
        
          <dd><a href="https://dscc-admin-ch.github.io/lomas-docs/v0.3.5/en/index.html">v0.3.5</a></dd>
        
          <dd><a href="https://dscc-admin-ch.github.io/lomas-docs/v0.4.1/en/index.html">v0.4.1</a></dd>
        
      </dl>
      
      <br>
      </dl>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>